---
title: "Entity Analysis"
author: "Rifat"
date: "Thursday, December 01, 2016"
output: pdf_document
---

In this document presents, Dbpedia and 3cixty classs entity analysis. In the 3cixty KB we use two classes and in the case of DBpedia we use 10 classes. Quality Dimensions are: Persistency and Stabiity.

#Persistency (Entity Level)

Persistency of a Class= 1 if, on the time series(i=1....n) , En > (En-1) else Persistency = 0

Where En is the distnct entity of a class. 

# Time Series Persistency (Entity Level)


#Stability (Entity Level)

First,we apply a Linear regression over the time series (i=1....n).  

From the linear regression, We calculate the normalize distance. 

The normalized distance(ND) = (abs(Last TimeSeries Entity Count - Predicted Value)/mean(abs(Residuals))

So, Stability is 1 if ND<1 or Stability is 0 if ND>=1

# Time Series Stability (Entity Level)


```{r,echo=FALSE,comment=NA,results='hide', message=FALSE, warning=FALSE}

library(ggplot2)
library(plyr)
library(dplyr)
library(dtplyr)
library(reshape2)
library(hts)
library('knitr')
library(reshape2)

library(plotly)

### Pre process Data

PropertyValue<-function(location){
  
setwd(location)
  
files = list.files(pattern="*.csv")
# First apply read.csv, then cbind
data = do.call(cbind, lapply(files, function(x) read.csv(x, stringsAsFactors = FALSE)))

id<-data.frame(id=data[,1])

noId<-data[ , -which(names(data) %in% c("id"))]

All<-cbind(id,noId)

WithProperty=merge(x = All, y = property_id, by = "id", all = TRUE)

WithProperty<-WithProperty[,order(colnames(WithProperty),decreasing=FALSE)]

require(data.table)
DT=data.table(WithProperty)

listCol <- colnames(DT)[grep("count", colnames(DT))]

DT[, Sum := Reduce('+', .SD), .SDcols=listCol][]

WithProperty=data.frame(DT)
  
return(WithProperty)

}


## Property_id
setwd("C:/Users/rifat/Desktop/R_milan/10Classes/")

property_id<- read.csv(file="property-id.csv",head=TRUE,sep=",")


##Set defult directory
# setwd("C:/Users/rifat/Desktop/R_milan/10Classes")


## Pre process Entity Data

path ="C:/Users/rifat/Desktop/R_milan/10Classes/entity"


DataSet=ldply(list.files(path,pattern="csv",full.names=TRUE),function(filename,dep) {
  dum=read.csv(filename)
  
  dum$filename=filename
  
  return(dum)
})

#DBpedia EN
# version  count   Release Data(YYYY-MM-DD)
# 3.3  12460081    2009-05-20
# 3.4  10758945    2009-09-20
# 3.5  18425111     2010-03-16
# 3.6  19732649     2010-10-11
# 3.7  24778996     2011-07-22
# 3.8  24794952     2012-06-01
# 3.9  27706239     2013-04-03
# 2014	29751955   2014-05-02
# 2015-04	38008086 2015-02-05  
# 2015-10	40427228 2015-10-02
# 2016-04	58283745 2016-04-01  

DataSet$dep<-substring(DataSet$filename, 49,65)

head(DataSet)

entityDataSet<-data.frame(version=DataSet$version,date=DataSet$version,count=DataSet$count,class=DataSet$dep)


levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2009-05-20")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2009-09-20")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2010-03-16")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2010-10-11")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2011-07-22")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2012-06-01")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2013-04-03")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2014-05-02")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2015-02-05")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2015-10-02")
levels(entityDataSet$date) <- c(levels(entityDataSet$date), "2016-04-01")
# iris$Species[iris$Species == 'virginica'] <- 'new.species'


entityDataSet$date[entityDataSet$date=='3.3'] <- '2009-05-20'
entityDataSet$date[entityDataSet$date=='3.4'] <- '2009-09-20'
entityDataSet$date[entityDataSet$date=='3.5'] <- '2010-03-16'
entityDataSet$date[entityDataSet$date=='3.6'] <- '2010-10-11'
entityDataSet$date[entityDataSet$date=='3.7'] <- '2011-07-22'
entityDataSet$date[entityDataSet$date=='3.8'] <- '2012-06-01'
entityDataSet$date[entityDataSet$date=='3.9'] <- '2013-04-03'
entityDataSet$date[entityDataSet$date=='2014'] <- '2014-05-02'
entityDataSet$date[entityDataSet$date=='2015-04'] <- '2015-02-05'
entityDataSet$date[entityDataSet$date=='2015-10'] <- '2015-10-02'
entityDataSet$date[entityDataSet$date=='2016-04'] <- '2016-04-01'

##Entity Plot Function
fnplot<-function(data){
  
  p<-ggplot(data=data, aes(x=date, y=count , group=class,color=class)) +
           geom_line() +
           geom_point()+theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
  return(p)
}

## Calculate Days
fn<-function(ver){
  startdate <- as.Date(ver[1])
  NumDays <- difftime(as.Date(ver),startdate ,units="days")
  
  return(as.numeric(NumDays))
  
}
entityWithDays= ddply(entityDataSet,.(class), here(transform), days=fn(date))

unclass=unique(entityWithDays$class)

# Function for normalizing property values based on entity count
# Parm: Property dataframe and exact entity count

normalize<-function(property,en){

dTproperty=property

dTproperty<-dTproperty[,order(colnames(dTproperty),decreasing=TRUE)]

d=3
t=11

for(i in 1:11){
  
    norm= dTproperty[,d]/en[t,]$count
    
#  round(x, digits = 0)
#  print(dTproperty[,d])  
  
    dTproperty[,d]=norm
    d=d+1
#     print(norm)
    t=t-1

}

# head(dTproperty)

dTproperty$diffLast=dTproperty[,3]-dTproperty[,4]
return(dTproperty)  
  
}


identifyProperty<-function(property,en){

dTproperty=property

dTproperty<-dTproperty[,order(colnames(dTproperty),decreasing=TRUE)]

d=3
t=11

for(i in 1:11){
  
    norm= dTproperty[,d]/en[t,]$count
    
#  round(x, digits = 0)
#  print(dTproperty[,d])  
  
    dTproperty[,d]=norm
    d=d+1
#     print(norm)
    t=t-1

}

# head(dTproperty)

dTproperty$diffLast=dTproperty[,3]-dTproperty[,4]
return(dTproperty)  
  
}

histPerAll<-function(entity){

  
entity$variation=0
 
 
 # for( j in 1:nrow(entity)){
 # 
 # if(nrow(entity)==11)
 entity$variation=0
 # 
 for( i in 2:nrow(entity)){
 
    temp=entity[,3]

    if(temp[i]<temp[i-1])
    entity[i,5]=1
    
    if( i %% 11 )
    entity[i,5]=0
      
  
     # sw=sw+1
   # }
}

return(entity)
  
}

plotPerAll<-function(data){

p<-ggplot(data=data, aes(x=date, y=variation , group=class,color=class)) +
           geom_line() +
           geom_point()+theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))

return(p)

}



```

```{r,fig.height=4,fig.width=10}


#Total entity plot
data=entityDataSet

p<-ggplot(data=data, aes(x=date, y=count , group=class,color=class)) +
           geom_line() +
           geom_point()+theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
p

xmin=data[10,2]
xmax=data[11,2]


rect <- data.frame(xmin=data[10,2], xmax=data[11,2], ymin=-Inf, ymax=Inf)
p + geom_rect(data=rect, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
              color="white",
              alpha=0.2,
              inherit.aes = FALSE)



data=histPerAll(data)

p<-plotPerAll(data)
p

```




# Entity Level

## Class:  dbo-animal 

```{r,echo=FALSE,comment=NA,results='hide', message=FALSE, warning=FALSE}
##dbo-animal

location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-animal"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_animalWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_animalWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]


dbo_animalProperty=dbo_animalWithPropertyNonZero[,-c(14)]

```


###Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

animal_data=entityDataSet[entityDataSet$class==unclass[1],]

entity=animal_data

n=nrow(animal_data)

fnplot(animal_data)

# fnplot(entityDataSet)

# require(data.table)
# df <- data.table(group=animal_data$version,value=animal_data$count,data=animal_data$date)
# #df <- data.table(df) #if df is already a data frame
# setkey(df,group)
# df[,diff:=c(0,diff(value)),by=group] 
# df <- as.data.frame(df) #if you want to convert back to old data.frame syntax
# df

histPer<-function(entity){
  
  
entity$variation=0

for( i in 2:nrow(entity)){
  
  temp=entity[,3]

  if(temp[i]<temp[i-1])
  entity[i,5]=1
  
}

return(entity)
  
}

plotPer<-function(data){

p<-ggplot(data=data, aes(x=date, y=variation , group=class,color=class)) +
           geom_line() +
           geom_point()+theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))

return(p)

}


# animal_data$variation=0
# 
# for( i in 2:nrow(animal_data)){
#   
#   temp=animal_data[,3]
# 
#   if(temp[i]<temp[i-1])
#   animal_data[i,5]=1
#   
# }

data=histPer(entity)

p<-plotPer(data)
p




```

In dbo-animal, Version2016-04 Entity Count=227963 <
               Version2015-10 Entitt Count=232019 

Persistency=0


### Stability
```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


animal_data_days=entityWithDays[entityWithDays$class==unclass[2],]

entity=animal_data_days

# diff(entity$days)

# diff(entity$days)/entity$days[-nrow(entity$days),] * 100

# entity$diffDays=0
# 
# for( i in 2:nrow(entity)){
#   
#   temp=entity[,5]
#   entity[i,6]=temp[i]-temp[i-1]
#   
# }
# 
# roc=entity$days
# 
# sapply(seq_along(roc)[-1], function(i) 100*(roc[i] - roc[i-1])/roc[i-1])

# 
# en=entity[1:nrow(entity)-1,]
# 
# enLm=lm(count~days,data=en)
# 
# 
# pred=data.frame(days=entity$days,count=predict(enLm,entity))
# 
# summary(enLm)
# 
# res=mean(abs(enLm$residuals))
#  
# ggplot(entity, aes(x = days, y = count)) + 
#    geom_point() +
#    geom_line(data=pred,color="red")+
#    geom_ribbon(data=pred,aes(ymin=count-res,ymax=count+res),alpha=0.2)
# 
# 
# pr=predict(enLm,entity[nrow(entity),])
# 
# lastValue=entity[nrow(entity),]$count
# 
# ND=abs(pr-lastValue)/res
# 
# if(ND<1)
#   stab=1
# 
# if(ND>=1)
#   stab=0




## Stability

plotEntity<-function(entity){
  
en=entity[1:nrow(entity)-1,]

enLm=lm(count~days,data=en)

pred=data.frame(days=entity$days,count=predict(enLm,entity))

summary(enLm)

res=mean(abs(enLm$residuals))
 
p<-ggplot(entity, aes(x = days, y = count)) + 
   geom_point() +
   geom_line(data=pred,color="red")+
   geom_ribbon(data=pred,aes(ymin=count-res,ymax=count+res),alpha=0.2)

return(p)

}


NormDist<-function(entity){
  
en=entity[1:nrow(entity)-1,]

enLm=lm(count~days,data=en)


pred=data.frame(days=entity$days,count=predict(enLm,entity))

summary(enLm)

res=mean(abs(enLm$residuals))
 

pr=predict(enLm,entity[nrow(entity),])

lastValue=entity[nrow(entity),]$count

ND=abs(pr-lastValue)/res

return(ND)
}

CheckND<-function(ND){
if(ND<1)
  stab=1

if(ND>=1)
  stab=0

return(stab)
}




ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`


## Class:  dbo-artist

```{r,echo=FALSE,comment=NA,results='hide', message=FALSE, warning=FALSE}

##dbo-artist

location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-artist"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_artistWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_artistWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_artist_Property=dbo_artistWithPropertyNonZero[,-c(14)]

# head(dbo_artist_Property)

```


### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

artist_data=entityDataSet[entityDataSet$class==unclass[2],]

entity=artist_data
n=nrow(artist_data)

fnplot(artist_data)

data=histPer(entity)

p<-plotPer(data)
p



```

In dbo-artist, Version2016-04 Entity Count=145879 <
               Version2015-10 Entitt Count=184371 

Persistency=0



### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


artist_data_days=entityWithDays[entityWithDays$class==unclass[2],]

entity=artist_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`



## Class:  dbo-athlete


```{r,echo=FALSE}

##dbo-athlete
location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-athlete"


WithProperty=PropertyValue(location)

#With Zero values 
dbo_athleteWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_athleteWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_athlete_Property=dbo_athleteWithPropertyNonZero[,-c(14)]

```

### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

athlete_data=entityDataSet[entityDataSet$class==unclass[3],]

entity=athlete_data

n=nrow(athlete_data)

fnplot(athlete_data)


data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=371804 <
               Version2015-10 Entitt Count=434609 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


athlete_data_days=entityWithDays[entityWithDays$class==unclass[3],]

entity=athlete_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`


## Class:  dbo-film

```{r,echo=FALSE}
##dbo-film
location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-film"


WithProperty=PropertyValue(location)

#With Zero values 
dbo_filmWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_filmWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_film_Property=dbo_filmWithPropertyNonZero[,-c(14)]

```

### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

film_data=entityDataSet[entityDataSet$class==unclass[4],]

entity=film_data

n=nrow(film_data)

fnplot(film_data)

data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=146449 <
               Version2015-10 Entitt Count=177989 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


film_data_days=entityWithDays[entityWithDays$class==unclass[4],]

entity=film_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`




## Class:  dbo-musicalWork

```{r,echo=FALSE}
##dbo-musicalWork
location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-musicalWork"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_musicalWorkWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_musicalWorkWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_musicalWork_Property=dbo_musicalWorkWithPropertyNonZero[,-c(14)]


```

### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

musicalWork_data=entityDataSet[entityDataSet$class==unclass[5],]
entity=musicalWork_data
n=nrow(musicalWork_data)

fnplot(musicalWork_data)

data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=146449 <
               Version2015-10 Entitt Count=177989 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


musicalWork_data_days=entityWithDays[entityWithDays$class==unclass[5],]

entity=musicalWork_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`


## Class:  dbo-organisation

```{r,echo=FALSE}

##dbo-organisation
location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-organisation"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_organisationWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_organisationWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_organisation_Property=dbo_organisationWithPropertyNonZero[,-c(14)]


```


### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

organisation_data=entityDataSet[entityDataSet$class==unclass[6],]
entity=organisation_data
n=nrow(organisation_data)

fnplot(organisation_data)

data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=359462 <
               Version2015-10 Entitt Count=435522 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


organisation_data_days=entityWithDays[entityWithDays$class==unclass[6],]

entity=organisation_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`



## Class:  dbo-place
```{r,echo=FALSE}

##dbo-place

location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-place"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_PlaceWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_PlaceWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_place_Property=dbo_PlaceWithPropertyNonZero[,-c(14)]


```



### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

place_data=entityDataSet[entityDataSet$class==unclass[7],]

entity=place_data
n=nrow(place_data)

fnplot(place_data)

data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=925383 <
               Version2015-10 Entitt Count=1122785 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


place_data_days=entityWithDays[entityWithDays$class==unclass[7],]

entity=place_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`



## Class:  dbo-species

```{r,echo=FALSE}

##dbo-species
location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-species"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_speciesWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_speciesWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_species_Property=dbo_speciesWithPropertyNonZero[,-c(14)]


```

### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

species_data=entityDataSet[entityDataSet$class==unclass[8],]

entity=species_data

n=nrow(species_data)

fnplot(species_data)

data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=925383 <
               Version2015-10 Entitt Count=1122785 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


species_data_days=entityWithDays[entityWithDays$class==unclass[8],]

entity=species_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`



## Class:  dbo-work
```{r,echo=FALSE}
##dbo-work
location="C:/Users/rifat/Desktop/R_milan/10Classes/dbo-work"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_workWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_workWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_work_Property=dbo_workWithPropertyNonZero[,-c(14)]

```

### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

work_data=entityDataSet[entityDataSet$class==unclass[9],]

entity=work_data

n=nrow(work_data)

fnplot(work_data)

data=histPer(entity)

p<-plotPer(data)
p

```

In dbo-artist, Version2016-04 Entity Count=571847 <
               Version2015-10 Entitt Count=683923 

Persistency=0


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


work_data_days=entityWithDays[entityWithDays$class==unclass[9],]

entity=work_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`



## Class:  dbo-person
```{r,echo=FALSE}
##dbo-person
location="C:/Users/rifat/Desktop/R_milan/10Classes/foaf-person"

WithProperty=PropertyValue(location)

#With Zero values 
dbo_personWithPropertyZero=WithProperty[WithProperty$Sum==0,]
# With NonZero Values
dbo_personWithPropertyNonZero=WithProperty[WithProperty$Sum!=0,]

dbo_person_Property=dbo_personWithPropertyNonZero[,-c(14)]


```
### Persistency

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}

person_data=entityDataSet[entityDataSet$class==unclass[10],]

# n=nrow(person_data)

entity=person_data

fnplot(person_data)

data=histPer(entity)

p<-plotPer(data)
p


```

In dbo-artist, Version2016-04 Entity Count=2703493 <
               Version2015-10 Entitt Count=1840598

Persistency=1


### Stability

```{r,echo=FALSE,fig.height=3,fig.width=6,comment=NA,results='hide', message=FALSE, warning=FALSE}


person_data_days=entityWithDays[entityWithDays$class==unclass[10],]

entity=person_data_days

ND<-NormDist(entity)

graph<-plotEntity(entity)

graph

stab<-CheckND(ND)

```

The normalized distance(ND)=(abs(Last TimeSeries Value - Predicted Value)/mean(abs(Residuals))= `r ND`

Stability is 1 if ND<1 or Stability is 0 if ND>=1

Stability=`r stab`



# Predicate Level

## Class:  dbo-animal 

DataSet overview:

No. of property with all zeros on all versions = `r nrow(dbo_animalWithPropertyZero)` 

No. of property with Non zeros on all versions = `r nrow(dbo_animalProperty)` 



### Completeness

```{r,echo=FALSE,comment=NA,results='hide', message=FALSE, warning=FALSE}

#  write.csv(dbo_animalProperty, file = "C:/Users/rifat/Desktop/R_milan/10Classes/propertyNonZero/dbo-animal.csv")

dTproperty<-dbo_animalProperty

# library(plyr)
dTproperty=plyr::rename(dTproperty, c("count33"="2009-05-20", "count34"="2009-09-20","count201504"="2015-02-05","count201510"="2015-10-02","count35"="2010-03-16","count36"="2010-10-11",
                           "count37"="2011-07-22","count38"="2012-06-01","count39"="2013-0-03","count40"="2014-05-02","count35.1"="2016-04-01"))


unclass=unique(entityWithDays$class)

en=entityDataSet[entityDataSet$class==unclass[1],]

# dTproperty=normalize(dTproperty,en)

dTproperty<-dTproperty[,order(colnames(dTproperty),decreasing=TRUE)]

NondTproperty=dTproperty

d=3
t=11

for(i in 1:11){
     
  countEntity=en[t,]$count/10000
  
#   print(countEntity)  
#   print(length(dTproperty[,d]))

  prop=dTproperty[,d]
  Nonprop=NondTproperty[,d]
  
  for(j in 1:length(prop)){
      
       if(prop[j]>countEntity){
         prop[j]=prop[j]
         Nonprop[j]=0
       }
       else{
         prop[j]=0           
       }
  }
  print(prop)  
  print(Nonprop)  
  
  dTproperty[,d]=prop
  NondTproperty[,d]=Nonprop
  d=d+1
  t=t-1
}


require(data.table)
DT=data.table(dTproperty)


listCol <- colnames(DT)[grep("-", colnames(DT))]

DT[, Sum := Reduce('+', .SD), .SDcols=listCol][]

Rproperty=data.frame(DT)

require(data.table)
DT=data.table(NondTproperty)

listCol <- colnames(DT)[grep("-", colnames(DT))]

DT[, Sum := Reduce('+', .SD), .SDcols=listCol][]

NonRproperty=data.frame(DT)

IncorrectProperty=NonRproperty[NonRproperty$Sum!=0,]

CorrectProperty=Rproperty[Rproperty$Sum!=0,]

nrow(NonRproperty)-nrow(IncorrectProperty)

nrow(Rproperty)-nrow(CorrectProperty)


NdTproperty=CorrectProperty[,-c(14)]

d=3
t=11

for(i in 1:11){
  
    norm= NdTproperty[,d]/en[t,]$count
    
#  round(x, digits = 0)
#  print(dTproperty[,d])  
  
    NdTproperty[,d]=norm
    d=d+1
     print(norm)
    t=t-1

}

# head(dTproperty)

NdTproperty$diffLast=NdTproperty[,3]-NdTproperty[,4]
NdTproperty



# print(dTproperty)
# head(dTproperty)

dTproperty$diffLast=dTproperty[,3]-dTproperty[,4]

consistencyData=NdTproperty[NdTproperty$diffLast<0,]

nrow(dTproperty)

nrow(consistencyData)

dataSet=data.frame(property=consistencyData$property,Version201604=consistencyData$X2016.04.01,Version201510=consistencyData$X2015.10.02,NormFreqDiff=consistencyData$diffLast)


```

No. of inconsistant property = `r nrow(consistencyData)`


Consistency=`r (1-(nrow(consistencyData)/nrow(dTproperty)))*100` 

List of inconsistant property

```{r,echo=FALSE}
kable(dataSet, format = "markdown")

```



